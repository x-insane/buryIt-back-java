<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xinsane.wxapp.mapper.PackageMapper">

    <resultMap id="ResultMap" type="com.xinsane.wxapp.pojo.Package">
        <id property="id" column="id" jdbcType="INTEGER" />
        <result column="user_id" jdbcType="INTEGER" property="userId" />
        <result column="title" jdbcType="VARCHAR" property="title" />
        <result column="real_mode" jdbcType="BIT" property="realMode" />
        <result column="type" jdbcType="VARCHAR" property="type" />
        <result column="package_total_num" jdbcType="INTEGER" property="packageTotalNum" />
        <result column="package_open_num" jdbcType="INTEGER" property="packageOpenNum" />
        <result column="cycle_time" jdbcType="INTEGER" property="cycleTime" />
        <result column="description" jdbcType="VARCHAR" property="description" />
        <result column="sender" jdbcType="VARCHAR" property="sender" />
        <result column="receiver" jdbcType="VARCHAR" property="receiver" />
        <result column="longitude" jdbcType="DOUBLE" property="longitude" />
        <result column="latitude" jdbcType="DOUBLE" property="latitude" />
        <result column="deep" jdbcType="INTEGER" property="deep" />
        <result column="password" jdbcType="VARCHAR" property="password" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="publish_time" jdbcType="TIMESTAMP" property="publishTime" />
        <result column="can_open_time" jdbcType="TIMESTAMP" property="canOpenTime" />
        <result column="delete_time" jdbcType="TIMESTAMP" property="deleteTime" />
    </resultMap>

    <select id="getPackageById" resultMap="ResultMap">
        SELECT * FROM package WHERE id = #{id} AND delete_time IS NULL LIMIT 1
    </select>

    <select id="getPackagesByUserId" resultMap="ResultMap">
        SELECT * FROM package WHERE user_id = #{userId} AND delete_time IS NULL
    </select>

    <update id="deletePackage">
        UPDATE package SET delete_time = NOW() WHERE id = #{id}
    </update>

    <insert id="createFreePackage" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO package (user_id, title, real_mode, type, cycle_time, description, sender, receiver)
                VALUE (#{userId}, #{title}, #{realMode}, #{type}, #{cycleTime}, #{description}, #{sender}, #{receiver})
    </insert>

    <insert id="createFixedPackage" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO package (user_id, title, real_mode, type, package_total_num, description, sender, receiver)
            VALUE (#{userId}, #{title}, #{realMode}, #{type}, #{packageTotalNum}, #{description}, #{sender}, #{receiver})
    </insert>

    <insert id="createPrivatePackage" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO package (user_id, title, real_mode, type, description, sender, receiver)
            VALUE (#{userId}, #{title}, #{realMode}, #{type}, #{description}, #{sender}, #{receiver})
    </insert>

    <update id="modifyFreePackage">
        UPDATE package
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="realMode != null">
                real_mode = #{realMode},
            </if>
            <if test="cycleTime != null">
                cycle_time = #{cycleTime},
            </if>
            <if test="description != null">
                description = #{description},
            </if>
            <if test="sender != null">
                sender = #{sender},
            </if>
            <if test="receiver != null">
                receiver = #{receiver},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="modifyFixedPackage">
        UPDATE package
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="realMode != null">
                real_mode = #{realMode},
            </if>
            <if test="packageTotalNum != null">
                package_total_num = #{packageTotalNum},
            </if>
            <if test="description != null">
                description = #{description},
            </if>
            <if test="sender != null">
                sender = #{sender},
            </if>
            <if test="receiver != null">
                receiver = #{receiver},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="modifyPrivatePackage">
        UPDATE package
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="realMode != null">
                real_mode = #{realMode},
            </if>
            <if test="description != null">
                description = #{description},
            </if>
            <if test="sender != null">
                sender = #{sender},
            </if>
            <if test="receiver != null">
                receiver = #{receiver},
            </if>
        </set>
        WHERE id = #{id}
    </update>

</mapper>